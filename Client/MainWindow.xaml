<Window x:Class="Client.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Client"
        mc:Ignorable="d"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal" 
        TextOptions.TextRenderingMode="Auto"        
        Background="Transparent"
        Foreground="White"
        FontFamily="pack://application:,,,/fonts/#Roboto"
        FontWeight="Light" 
        Height="500" MinHeight="500" MinWidth="650" Width="900" 
        ResizeMode="CanResize" WindowStartupLocation="CenterScreen" AllowsTransparency="True" Title="Zireael"
        WindowStyle="None"  Icon="images/ico/Zireael_logo.512.ico" Loaded="MainWindow_Loaded" Closing="MainWindow_Closing">
    <WindowChrome.WindowChrome>
        <WindowChrome 
            CaptionHeight="0"
            ResizeBorderThickness="8" GlassFrameThickness="-1"/>
    </WindowChrome.WindowChrome>

    <Grid Margin="6 6 0 0">
        <Grid.RowDefinitions>
            <RowDefinition Height="{StaticResource HeaderHeightGridLength}"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid x:Name="GridHeader" 
              Grid.ColumnSpan="2" Background="{StaticResource HeaderBackground}" MouseLeftButtonDown="GridHeader_OnMouseDown">
            <Image Height="18" Width="Auto" Source="images/png/NonBack_Zireael_logo.32.png" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="5 0"></Image>
            <StackPanel Margin="0 0 7 0" Orientation="Horizontal" HorizontalAlignment="Right">

                <Button Width="{StaticResource HeaderButtonWidth}" Height="{StaticResource HeaderHeight}" BorderBrush="{x:Null}" VerticalContentAlignment="Bottom" 
                        Click="Collapse_Button_Click" Style="{DynamicResource HeaderButtonStyle}" Template="{StaticResource HeaderButtonTemplate}">
                    <materialDesign:PackIcon Kind="Minus" Height="15"/>
                </Button>

                <Button Width="{StaticResource HeaderButtonWidth}" Height="{StaticResource HeaderHeight}" BorderBrush="{x:Null}" Click="ExpandWindow_Button_Click"
                        Style="{StaticResource HeaderButtonStyle}" Template="{StaticResource HeaderButtonTemplate}">
                    <materialDesign:PackIcon Kind="SquareOutline" Height="12"/>
                </Button>

                <Button Width="{StaticResource HeaderButtonWidth}" Height="{StaticResource HeaderHeight}" BorderBrush="{x:Null}" Click="ButtonFechar_OnClick" 
                        Style="{StaticResource HeaderExitButtonStyle}" Template="{StaticResource HeaderButtonTemplate}">
                    <materialDesign:PackIcon Kind="Close"/>
                </Button>

            </StackPanel>
        </Grid>

        <Grid Name="WorkGrid" 
              Grid.Row="1">

            <Grid Name="AuthGrid" 
                  Visibility="Visible" Background="{StaticResource LoginGridBackground}"
                  Grid.ColumnSpan="2" MouseLeftButtonUp="Login_Grid_Click">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Image Source="images/png/NonBack_Zireael_logo.32.png" Width="30" Height="Auto"/>
                        <TextBlock Text="ZIREAEL" FontSize="25"  Foreground="{StaticResource LoginForeground}" Margin="10 0"/>
                    </StackPanel>

                    <TextBlock FontSize="20" Name="AuthLoginTextBox" Foreground="{StaticResource LoginForeground}" Margin="20"/>

                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                        Value="-1" IsIndeterminate="True"/>

                </StackPanel>
            </Grid>

            <Grid Name="LoginGrid" 
                  Visibility="Visible" Background="{StaticResource LoginGridBackground}"
              Grid.ColumnSpan="2" MouseLeftButtonUp="Login_Grid_Click">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0 0 0 60">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Image Source="images/png/NonBack_Zireael_logo.32.png" Width="30" Height="Auto"/>
                        <TextBlock Text="Zireael" FontSize="25"  Foreground="{StaticResource LoginForeground}" Margin="10"/>
                    </StackPanel>

                    <TextBox Style="{StaticResource LoginTextBoxStyle}"
                         materialDesign:HintAssist.Hint="Логин"
                         Name="LoginTextBox"/>

                    <PasswordBox Style="{StaticResource LoginPasswordBoxStyle}"
                         materialDesign:HintAssist.Hint="Пароль"
                         Name="LoginPasswordBox"/>

                    <Button Content="ВОЙТИ" Style="{StaticResource LoginButtonStyle}"
                        Click="AccountLogIn_Button_Click" Template="{DynamicResource ButtonControlTemplate}"/>

                    <TextBlock Margin="10 5" Text="Забыли пароль"  Style="{StaticResource RegisterTextBlockStyle}"
                           MouseLeftButtonUp="RestorePasswordOpen_TextBlock_Click"/>

                    <TextBlock Margin="10 5" Text="Регистрация"  Style="{StaticResource RegisterTextBlockStyle}"
                               MouseLeftButtonUp="RegistrationOpen_Button_Click"/>

                    <ProgressBar 
                    Style="{StaticResource MaterialDesignCircularProgressBar}"
                    Value="-1" IsIndeterminate="True" 
                    Visibility="Hidden" Name="LoginProgressBar"/>

                </StackPanel>
            </Grid>

            <Grid Name="RegistrationGrid" 
                  Visibility="Visible" Background="{StaticResource LoginGridBackground}">

                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"  Name="SettintsStackPanel">

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                        <materialDesign:PackIcon Kind="AccountPlus" Width="50" Height="Auto" HorizontalAlignment="Center" Margin="0 0 0 0" 
                                             HorizontalContentAlignment="Center" Foreground="{StaticResource LoginForeground}"/>
                        <TextBlock Text="Регистрация" FontSize="30"  Foreground="{StaticResource LoginForeground}" Margin="10"/>

                    </StackPanel>


                    <TextBox Style="{StaticResource LoginTextBoxStyle}"
                         materialDesign:HintAssist.Hint="Логин*"
                         Name="RegistrationLoginTextBox"/>

                    <TextBox Style="{StaticResource LoginTextBoxStyle}"
                         materialDesign:HintAssist.Hint="Почта (необязательно)"
                         Name="RegistrationEmailTextBox"/>

                    <PasswordBox Style="{StaticResource LoginPasswordBoxStyle}"
                             materialDesign:HintAssist.Hint="Пароль*"
                             Name="RegistrationPasswordBox"/>

                    <PasswordBox Style="{StaticResource LoginPasswordBoxStyle}"
                             materialDesign:HintAssist.Hint="Подтверждение пароля*"
                             Name="RegistrationConfirmPasswordBox"/>

                    <TextBlock Width="230" TextWrapping="Wrap" TextAlignment="Center" Text="Без почты восстановить забытый пароль будет невозможно"/>

                    <Button Style="{StaticResource LoginButtonStyle}" Template="{DynamicResource ButtonControlTemplate}"
                        Click="RegistrationSave_Button_Click"  Content="Зарегистрироваться"/>

                    <ProgressBar  Visibility="Hidden" Name="RegistrationProgressBar"
                        Style="{StaticResource MaterialDesignCircularProgressBar}"
                        Value="-1" IsIndeterminate="True" />

                </StackPanel>

                <Button Margin="10" VerticalAlignment="Top" HorizontalAlignment="Left" Style="{StaticResource MaterialDesignFlatButton}" 
                    Height="35" Padding="5" Click="RegistrationClose_Button_Click">
                    <materialDesign:PackIcon Kind="ArrowLeftBold" Width="35" Height="Auto"  HorizontalAlignment="Center" 
                                         HorizontalContentAlignment="Center"/>
                </Button>
            </Grid>

            <Grid Name="MainGrid" Background="{StaticResource MessagesBackground}">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.33*" MaxWidth="350" MinWidth="250"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height="50"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <StackPanel Name="MenuSearchDots" Grid.Row="0" Grid.Column="0" Background="{StaticResource GroupsBackground}">
                    <Grid Margin="6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="25"/>
                        </Grid.ColumnDefinitions>

                        <ToggleButton Style="{StaticResource MaterialDesignHamburgerToggleButton}" IsChecked="False"
                                  x:Name="MenuToggleButton" Foreground="{StaticResource GroupsForeground}" Width="Auto" Height="25"/>

                        <TextBox materialDesign:HintAssist.Hint="Поиск" Grid.Column="1"
                         Margin="5 5 0 5" FontSize="16" Name="AddUserNameTextBox"
                         Foreground="{StaticResource GroupSearchForeground}"
                         Style="{StaticResource MaterialDesignTextBox}" TextChanged="SearchUsers_TextBox_TextChanged"/>

                        <materialDesign:PopupBox Padding="0" Margin="0" Height="Auto" BorderThickness="0" PlacementMode="BottomAndAlignRightEdges"
                                             Foreground="{StaticResource GroupsForeground}" Grid.Column="2" Width="Auto" StaysOpen="True" Name="SubMenuPopup">
                            <StackPanel Background="{StaticResource GroupsBackground}">
                                <Button Content="Прочитать все сообщения" Margin="1" Name="GroupsSubMenuButton" 
                                    Template="{DynamicResource FlatButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" 
                                    Click="ReadAllMessages_MenuItem_Click"/>
                            </StackPanel>
                        </materialDesign:PopupBox>
                    </Grid>
                </StackPanel>

                <ScrollViewer Name="GroupsScroll"  Grid.Row="1" Grid.Column="0" VerticalScrollBarVisibility="Auto" Background="{StaticResource GroupsBackground}">
                    <ItemsControl Name="GroupsItemsControl" Background="{StaticResource GroupsBackground}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <ItemContainerTemplate>
                                <Grid>
                                    <Grid MouseLeftButtonUp="ChatOpen_MenuItem_Click" Height="60">
                                        <Grid.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Удалить" Click="DeleteGroup_MenuItem_Click"/>
                                            </ContextMenu>
                                        </Grid.ContextMenu>
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource GroupMouseOverBackground}"/>
                                                    </Trigger>
                                                    <DataTrigger Binding="{Binding IsSelectedGroup}" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource GroupSelectedBackground}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>

                                        <Grid Margin="5" >
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto" MaxWidth="150"/>
                                                <ColumnDefinition/>
                                            </Grid.ColumnDefinitions>

                                            <Grid.RowDefinitions>
                                                <RowDefinition/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Ellipse Grid.Row="0" Grid.RowSpan="2" Height="46" Width="46" Grid.Column="0">
                                                <Ellipse.Fill>
                                                    <ImageBrush ImageSource="{Binding GroupImage}"/>
                                                </Ellipse.Fill>
                                            </Ellipse>

                                            <TextBlock  Grid.Row="0" Grid.Column="1" Margin="5 5" Text="{Binding Group.Name, Converter={StaticResource DisplayNameToTextConverter}}"
                                                FontWeight="Medium" Foreground="{StaticResource GroupNameForeground}"/>

                                            <TextBlock  Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Margin="5 3" 
                                                Text="{Binding Group.LastMessage, Converter={StaticResource MessageToTextConverter}}" Style="{StaticResource GroupTextStyle}">
                                            </TextBlock>

                                            <TextBlock Grid.Row="0" Grid.Column="2" HorizontalAlignment="Right" Margin="5 5"
                                               Text="{Binding Group.LastMessage.DateTime, Converter={StaticResource DateConverter}}" 
                                               Style="{StaticResource GroupTextStyle}"/>

                                            <Grid Grid.Row="1" Grid.Column="2" HorizontalAlignment="Right" Margin="5">

                                                <Grid.Style>
                                                    <Style TargetType="Grid">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding NotReadMessagesCount}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Grid.Style>

                                                <Rectangle Fill="{StaticResource GroupUnreadMessageBackground}" RadiusX="8" RadiusY="8" />
                                                <TextBlock Text="{Binding NotReadMessagesCount}" Margin="7 0"
                                        Foreground="{StaticResource GroupUnreadMessageForeground}"/>
                                            </Grid>
                                        </Grid>
                                    </Grid>

                                    <Grid Name="SearchTemplate" Height="60" MouseLeftButtonUp="SearchItem_Button_Click" Visibility="Collapsed">

                                    </Grid>
                                </Grid>
                            </ItemContainerTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Grid Name="HintGrid" Grid.Column="1" Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Rectangle RadiusX="7" RadiusY="7" Fill="{StaticResource SystemMessageBackground}"/>
                    <TextBlock Margin="10 5" Text="выберите чат, чтобы начать обмен сообщениями" 
                           Foreground="{StaticResource SystemMessageForeground}"/>
                </Grid>

                <Grid Name="MessagesGrid" Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" Style="{StaticResource HideWhenGroupUnselectedStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition/>
                        <RowDefinition MinHeight="45" Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid Name="GroupInfoGrid"
                          Grid.Row="0" Grid.Column="0" Background="{StaticResource GroupInfoBackground}">

                        <StackPanel Name="DisplayNameAndOnline" Margin="10">
                            <TextBlock Text="{local:MultiBinder {Binding User.DisplayName}, {Binding Group.Name}, {StaticResource GroupDisplayNameConverter}}"/>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="{Binding User.LastTimeOnline, Converter={StaticResource DateTimeToLastTimeOnline}}"/>
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding User.IsOnline}" Value="True">
                                                <Setter Property="Text" Value="Online"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Group.Type}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <TextBlock Text="{Binding DataContext.Group.Users.Count, ElementName=GroupInfoGrid, Converter={StaticResource UsersCountConverter}}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Group.Type}" Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <StackPanel Name="ButtonsGridInfo" 
                                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0">

                            <Button Style="{StaticResource MaterialDesignFlatButton}" Background="Transparent" Margin="2 0"
                                    Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" Padding="3" Content="{materialDesign:PackIcon Kind=Search, Size=26}"/>

                            <Button Background="Transparent" Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" 
                                     Margin="2 0" Padding="3" Click="AddContactToGroupOpen_Button_Click">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                        <Setter Property="Content" Value="{materialDesign:PackIcon Kind=AccountPlus, Size=26}"/>
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Group.Type}" Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <Button Background="Transparent" Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" 
                                     Margin="2 0" Padding="3" Click="MessagesDelete_Button_Click" Foreground="{StaticResource GroupInfoIconsForeground}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                        <Setter Property="Content" Value="{materialDesign:PackIcon Kind=Delete, Size=26}"/>
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Content" Value="{materialDesign:PackIcon Kind=DeleteEmpty, Size=26}"/>
                                            </Trigger>
                                            <DataTrigger Binding="{Binding HaveSelectedMessages}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <Button Style="{StaticResource MaterialDesignFlatButton}" Background="Transparent" Margin="2 0" Visibility="Collapsed"
                                    Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" Padding="3" Content="{materialDesign:PackIcon Kind=DotsVertical, Size=26}"/>

                            <materialDesign:PopupBox HorizontalAlignment="Right" Padding="0" Foreground="{StaticResource GroupsForeground}" Background="{StaticResource GroupsBackground}"
                                                     Name="GroupInfoSubMenu" PopupMode="Click" StaysOpen="True">
                                <StackPanel Background="{StaticResource GroupsBackground}">
                                    <MenuItem Header="{Binding IsUserBlockedInfo, Converter={StaticResource UserBlockedToMenuItemHeaderConvertrer}}" Margin="1"
                                        Click="BlackListAddOrRemove_MenuItem_Click" Style="{StaticResource MenuVisibleOnSingleGroup}">
                                    </MenuItem>
                                    <!-- TODO -->
                                    <MenuItem Header="Добавить/Удалить контакт" Style="{StaticResource MenuVisibleOnSingleGroup}"></MenuItem>
                                    <MenuItem Header="Удалить чат" Style="{StaticResource MenuVisibleOnSingleGroup}"></MenuItem>
                                    <MenuItem Header="Покинуть группу" Style="{StaticResource MenuVisibleOnMultyGroup}"></MenuItem>
                                </StackPanel>
                            </materialDesign:PopupBox>

                        </StackPanel>

                    </Grid>

                    <Grid Name="TypeMessageGrid" 
                          Grid.Row="2" Background="{StaticResource MessageTypeTextBoxBackground}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="85"/>
                        </Grid.ColumnDefinitions>

                        <Button Template="{DynamicResource FlatCircleButtonWithOutProgresBarControlTemplate}" Height="37" Width="Auto" Style="{StaticResource MaterialDesignFlatButton}" 
                            Padding="0" FontSize="25" Click="SendFile_Button_Click">
                            <Button.Content>
                                <materialDesign:PackIcon Kind="PaperclipHorizontal" Width="Auto" Height="25"/>
                            </Button.Content>
                        </Button>

                        <TextBox Margin="3" Grid.Column="1" TextWrapping="Wrap" VerticalAlignment="Center"
                        Height="30" VerticalScrollBarVisibility="Auto" FontSize="15" 
                        Foreground="{StaticResource MessageTypeTextBoxForeground}" Name="MessageTextBox"
                        AcceptsTab="True" BorderThickness="0" materialDesign:HintAssist.Hint="Напишите сообщение..."/>

                        <emoji:RichTextBox  Margin="3" Grid.Column="1" VerticalAlignment="Center" Visibility="Collapsed"
                        Height="30" VerticalScrollBarVisibility="Auto" FontSize="18" Background="Transparent"
                        Foreground="{StaticResource MessageTypeTextBoxForeground}" Name="MessageTextBox1" materialDesign:HintAssist.Hint="Напишите сообщение..."
                        AcceptsTab="True" BorderThickness="0" AcceptsReturn="False"/>

                        <Grid Grid.Column="2">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Template="{DynamicResource FlatCircleButtonWithOutProgresBarControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" 
                            Padding="0" Width="35" Height="35" Content="{materialDesign:PackIcon Kind=Emoticon,Size=25}">

                            </Button>

                            <Button Grid.Column="1" Click="SendMessage_Button_Click" Width="35" Height="35"
                                    Template="{DynamicResource FlatCircleButtonWithOutProgresBarControlTemplate}" 
                                    Padding="0" Content="{materialDesign:PackIcon Kind=Send,Size=25}"
                                    Foreground="{StaticResource SendMessageButtonForeground}">

                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                        <Setter Property="IsDefault" Value="False"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Visibility,ElementName=MainGrid}" Value="Visible">
                                                <Setter Property="IsDefault" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>


                    </Grid>

                    <ScrollViewer Name="MessagesScrollViewer" 
                                  Background="{StaticResource MessagesBackground}" Grid.Row="1" Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0 0 5 0">

                        <ItemsControl Name="MessagesItemsControl">

                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel VerticalAlignment="Bottom"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <ItemContainerTemplate>
                                    <Grid VerticalAlignment="Top" Margin="0 3" PreviewMouseRightButtonUp="Message_PreviewMouseRightButtonUp"
                                      MaxWidth="400" MouseLeftButtonUp="Message_Item_MouseLeftButtonUp" MouseLeftButtonDown="Message_Item_MouseLeftButtonDown">
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="HorizontalAlignment" Value="Left"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsRight}" Value="True">
                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>
                                        <Grid.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Выделить" Click="MessageSelect_MenuItem_Click"/>
                                                <MenuItem Header="Удалить" Click="MessageDelete_MenuItem_Click"/>
                                            </ContextMenu>
                                        </Grid.ContextMenu>

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>

                                        </Grid.ColumnDefinitions>

                                        <Ellipse Width="35" Height="35" Grid.RowSpan="2" Grid.Row="0" Margin="5 0 5 0" VerticalAlignment="Bottom">

                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Grid.Column" Value="0"/>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsRight}" Value="True">
                                                            <Setter Property="Grid.Column" Value="3"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>

                                            <Ellipse.Fill>
                                                <ImageBrush ImageSource="{Binding UserImage}"/>
                                            </Ellipse.Fill>

                                            <Ellipse.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Открыть аватар" Click="OpenImage_MenuItem_Click"/>
                                                    <MenuItem Header="Открыть чат" Style="{StaticResource MenuVisibleOnLeftSide}" Click="ChatOpen_MenuItem_Click"/>
                                                    <MenuItem Header="{Binding IsContact, Converter={StaticResource UserInContactsToMenuItemHeaderConvertrer}}" 
                                                              Click="ContactAddOrRemove_MenuItem_Click" Style="{StaticResource MenuVisibleOnLeftSide}"/>
                                                    <MenuItem Header="{Binding IsUserBlocked, Converter={StaticResource UserBlockedToMenuItemHeaderConvertrer}}" 
                                                              Click="BlackListAddOrRemove_MenuItem_Click" Style="{StaticResource MenuVisibleOnLeftSide}"/>
                                                </ContextMenu>
                                            </Ellipse.ContextMenu>

                                        </Ellipse>

                                        <Rectangle Grid.Row="0" Grid.Column="1" Grid.RowSpan="2" Grid.ColumnSpan="2" RadiusX="7" RadiusY="7">
                                            <Rectangle.Style>
                                                <Style TargetType="Rectangle">
                                                    <Setter Property="Fill" Value="{StaticResource OtherMessageBackground}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                            <Setter Property="Fill" Value="{StaticResource SystemMessageBackground}"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding IsRight}" Value="True">
                                                            <Setter Property="Fill" Value="{StaticResource MyMessageBackground}"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding IsSelectedMessage}" Value="True">
                                                            <Setter Property="Fill" Value="{StaticResource MessageSelectedBackground}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Rectangle.Style>
                                        </Rectangle>

                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Message.Sender.DisplayName}" FontWeight="Medium" 
                                               Foreground="{StaticResource GroupNameForeground}" Margin="10 5 10 0" >
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <Grid Name="TextMessage" Grid.Column="1" Grid.Row="1" Visibility="{Binding Converter={StaticResource TextMessageToVisibleConverter}}">
                                            <TextBox Background="Transparent" BorderThickness="0" TextWrapping="Wrap" Text="{Binding Message.Text}" IsReadOnly="True" IsReadOnlyCaretVisible="False"
                                               Foreground="{StaticResource MessageForeground}" Margin="10 5" HorizontalAlignment="Left" VerticalAlignment="Bottom">
                                                <TextBox.Style>
                                                    <Style TargetType="TextBox">
                                                        <Setter Property="BorderThickness" Value="0"></Setter>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsFocused" Value="True">
                                                                <Setter Property="BorderThickness" Value="0"></Setter>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBox.Style>
                                            </TextBox>
                                        </Grid>

                                        <Grid Name="FileMessage" Grid.Column="1" Grid.Row="1" Margin="5"
                                          Visibility="{Binding Converter={StaticResource FileMessageToVisibleConverter}}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition/>
                                            </Grid.ColumnDefinitions>

                                            <Grid.RowDefinitions>
                                                <RowDefinition/>
                                                <RowDefinition/>
                                            </Grid.RowDefinitions>

                                            <Button Grid.Column="0" Grid.Row="0" Grid.RowSpan="2" Click="MessageFile_IconButton_Click"
                                                Template="{StaticResource FlatCircleButtonControlTemplate}"
                                                Width="40" Height="40" Margin="5" Foreground="{StaticResource FileMessageForeround}" Padding="0"
                                                Background="{StaticResource FileMessageBackground}"
                                                materialDesign:ButtonProgressAssist.IndicatorBackground="Transparent"
                                                materialDesign:ButtonProgressAssist.IndicatorForeground="{StaticResource FileMessageForeround}"
                                                materialDesign:ButtonProgressAssist.Value="{Binding PackagesDownloaded}"
                                                materialDesign:ButtonProgressAssist.Minimum="0"
                                                materialDesign:ButtonProgressAssist.Maximum="{Binding PackageCount}"
                                                materialDesign:ButtonProgressAssist.Opacity="1"
                                                materialDesign:ButtonProgressAssist.IsIndeterminate="False">
                                                <Button.Style>
                                                    <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="Button">
                                                        <Setter Property="materialDesign:ButtonProgressAssist.IsIndicatorVisible" Value="False"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding FileDownloadState}" Value="1">
                                                                <Setter Property="materialDesign:ButtonProgressAssist.IsIndicatorVisible" Value="True"></Setter>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding FileDownloadState}" Value="3">
                                                                <Setter Property="materialDesign:ButtonProgressAssist.IsIndicatorVisible" Value="True"></Setter>
                                                            </DataTrigger>
                                                        </Style.Triggers>

                                                    </Style>
                                                </Button.Style>
                                                <materialDesign:PackIcon Width="25"  Height="Auto" Margin="0">
                                                    <materialDesign:PackIcon.Style>
                                                        <Style TargetType="materialDesign:PackIcon">
                                                            <Setter Property="Kind" Value="Close"></Setter>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding FileDownloadState}" Value="0">
                                                                    <Setter Property="Kind" Value="Download"></Setter>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding FileDownloadState}" Value="2">
                                                                    <Setter Property="Kind" Value="File"></Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </materialDesign:PackIcon.Style>
                                                </materialDesign:PackIcon>
                                            </Button>

                                            <TextBlock TextWrapping="NoWrap" Margin="5" FontWeight="Bold" VerticalAlignment="Center" Foreground="{StaticResource MessageForeground}" 
                                                   Grid.Column="1" Grid.Row="0" Text="{Binding Message.File.Name, Converter={StaticResource FileNameConverter}}"/>

                                            <TextBlock TextWrapping="NoWrap" Margin="5" FontWeight="Light" VerticalAlignment="Center" Foreground="{StaticResource MessageForeground}"
                                                   Grid.Column="1" Grid.Row="1" Text="{local:MultiBinder {Binding PackagesDownloaded}, {Binding}, {Binding FileDownloadState}, {StaticResource PackagesToBytesConverter}}"/>
                                        </Grid>

                                        <StackPanel  Grid.Row="1" Grid.Column="2" Orientation="Horizontal">
                                            <TextBlock Text="{Binding Message.DateTime, Converter={StaticResource DateConverter}}" 
                                               Foreground="{StaticResource MessageOtherTextForeground}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="3 4">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>

                                            <materialDesign:PackIcon VerticalAlignment="Bottom" Margin="0 0 4 4" Kind="ClockOutline" Foreground="{StaticResource MessageOtherTextForeground}">
                                                <materialDesign:PackIcon.Style>
                                                    <Style TargetType="materialDesign:PackIcon">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsMessageCome}" Value="True">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </materialDesign:PackIcon.Style>
                                            </materialDesign:PackIcon>

                                            <materialDesign:PackIcon VerticalAlignment="Bottom" Margin="0 0 4 4"
                                                                 Foreground="{StaticResource MessageOtherTextForeground}">
                                                <materialDesign:PackIcon.Style>
                                                    <Style TargetType="materialDesign:PackIcon">
                                                        <Setter Property="Kind" Value="Check"/>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Message.Sender.Login}" Value="system">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsMessageCome}" Value="False">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsRight}" Value="False">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Message.IsRead}" Value="True">
                                                                <Setter Property="Kind" Value="TickAll"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </materialDesign:PackIcon.Style>
                                            </materialDesign:PackIcon>
                                        </StackPanel>
                                    </Grid>
                                </ItemContainerTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <Grid Name="LoadindMessagesWarning" 
                          Grid.Row="1" Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Visibility" Value="Collapsed"></Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Items.Count, ElementName=MessagesItemsControl}" Value="0">
                                        <Setter Property="Visibility" Value="Visible"></Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Rectangle RadiusX="7" RadiusY="7" Fill="{StaticResource SystemMessageBackground}"/>
                        <TextBlock Margin="10 5" Text="загрузка сообщений" 
                                   Foreground="{StaticResource SystemMessageForeground}"/>
                    </Grid>

                    <Border BorderThickness="1 0 0 0" BorderBrush="{StaticResource MessagesBackground}" 
                              Grid.Row="0" Grid.RowSpan="3"/>

                </Grid>

                <materialDesign:DrawerHost Name="SideMenuDrawerHost" Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       IsLeftDrawerOpen="{Binding IsChecked, ElementName=MenuToggleButton}">
                    <materialDesign:DrawerHost.LeftDrawerContent>
                        <Grid Background="{StaticResource GroupsBackground}" Width="250">
                            <StackPanel>
                                <StackPanel Background="{StaticResource SideMenuUpBackground}">
                                    <Ellipse Width="50" Height="50" HorizontalAlignment="Left" Margin="20" Name="SideMenuUserImage">
                                        <Ellipse.Fill>
                                            <ImageBrush ImageSource="{Binding LoginedUserImage}"/>
                                        </Ellipse.Fill>
                                    </Ellipse>
                                    <TextBlock FontWeight="Medium" Margin="25 0" Text="{Binding LoginedUser.DisplayName}" Foreground="{StaticResource GroupNameForeground}"/>
                                    <TextBlock Margin="25 5" Text="{Binding LoginedUser.Email}"/>

                                </StackPanel>

                                <StackPanel Margin="0 20">
                                    <Button Style="{StaticResource MaterialDesignFlatButton}" HorizontalContentAlignment="Left" FontSize="18" 
                                        Template="{DynamicResource FlatMenuButtonControlTemplate}" Height="50" Click="CreateGroupOpen_Button_Click">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 7">
                                            <materialDesign:PackIcon Kind="AccountMultiple" Margin="5 0" Width="Auto" Height="25"/>
                                            <TextBlock Margin="10 0" Text="Новая группа" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}" HorizontalContentAlignment="Left" FontSize="18" 
                                        Template="{DynamicResource FlatMenuButtonControlTemplate}" Height="50" Click="ContactsOpen_Button_Click">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 7">
                                            <materialDesign:PackIcon Kind="Account" Margin="5 0" Width="Auto" Height="25"/>
                                            <TextBlock Margin="10 0" Text="Контакты" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}" HorizontalContentAlignment="Left" FontSize="18" 
                                        Template="{DynamicResource FlatMenuButtonControlTemplate}" Height="50" Click="SettingsOpen_Button_Click">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 7">
                                            <materialDesign:PackIcon Kind="Settings" Margin="5 0" Width="Auto" Height="25"/>
                                            <TextBlock Margin="10 0" Text="Настройки" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}" HorizontalContentAlignment="Left" FontSize="18" 
                                        Click="AccountLogOut_Button_Click" Template="{DynamicResource FlatMenuButtonControlTemplate}" Height="50">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 7">
                                            <materialDesign:PackIcon Kind="LogoutVariant" Margin="5 0" Width="Auto" Height="25"/>
                                            <TextBlock Margin="10 0" Text="Выход" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </materialDesign:DrawerHost.LeftDrawerContent>
                </materialDesign:DrawerHost>

            </Grid>

            <Grid Name="AddContactsToGroupDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsAddContactsToGroupDialogOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsAddContactsToGroupDialogOpen}" MouseLeftButtonUp="SettingsClose_Background_Click"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsAddContactsToGroupDialogOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Добавить в группу" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="0">
                                    <StackPanel MaxHeight="450" Width="300">
                                        <TextBlock Text="Контактов нет" TextAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Items.Count, ElementName=ContactsItemsControl}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="250">
                                            <ItemsControl Name="AddContactsToGroupItemsControl">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <ItemContainerTemplate>
                                                        <Grid Height="60" MouseLeftButtonUp="ContactSelect_Item_Click">
                                                            <Grid.Style>
                                                                <Style TargetType="Grid">
                                                                    <Setter Property="IsEnabled" Value="True"/>
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupMouseOverBackground}"/>
                                                                        </Trigger>
                                                                        <DataTrigger Binding="{Binding IsSelectedContact}" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupSelectedBackground}"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding IsDisabledContact}" Value="True">
                                                                            <Setter Property="IsEnabled" Value="False"/>
                                                                            <Setter Property="Background" Value="{StaticResource ContactDisabledBackground}"/>
                                                                        </DataTrigger>

                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Grid.Style>
                                                            <Grid Margin="10">

                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="50"/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>

                                                                <ToggleButton Grid.Column="0" Width="40" Height="40" IsChecked="{Binding IsSelectedContact}" Style="{StaticResource MaterialDesignActionToggleButton1}">
                                                                    <ToggleButton.Content>
                                                                        <Image Source="{Binding UserImage}"></Image>
                                                                    </ToggleButton.Content>
                                                                    <materialDesign:ToggleButtonAssist.OnContent>
                                                                        <Grid>
                                                                            <Image Source="{Binding UserImage}"/>
                                                                            <Grid Background="Black" Opacity="0.7"/>
                                                                            <materialDesign:PackIcon Kind="Check" Foreground="White" FontWeight="Medium" 
                                                                                                     VerticalAlignment="Center" HorizontalAlignment="Center"></materialDesign:PackIcon>

                                                                        </Grid>
                                                                    </materialDesign:ToggleButtonAssist.OnContent>
                                                                </ToggleButton>

                                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding Contact.DisplayName}" Margin="0 3"/>
                                                                    <TextBlock Margin="0 3">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="{Binding Contact.LastTimeOnline, Converter={StaticResource DateTimeToLastTimeOnline}}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Contact.IsOnline}" Value="True">
                                                                                        <Setter Property="Text" Value="Online"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Grid>
                                                    </ItemContainerTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                                            <Button Content="Отменить" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Click="ContactsAddToGroupClose_Button_Click" Margin="5 0"/>
                                            <Button Content="Добавить" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Click="AddContactToGroup_Button_Click" Margin="5 0"/>
                                        </StackPanel>

                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="CreateGroupDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsCreateGroupDialogOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsCreateGroupDialogOpen}" MouseLeftButtonUp="SettingsClose_Background_Click"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsCreateGroupDialogOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Создать группу" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="0">
                                    <StackPanel MaxHeight="450" Width="300">
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" FontWeight="Medium" Margin="10 0" 
                                                 materialDesign:HintAssist.Hint="Название*" Name="NewGroupNameTextBox"/>

                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" FontWeight="Medium" Margin="10 5" 
                                                 materialDesign:HintAssist.Hint="Описание(необязательно)" Name="NewGroupDescriptionTextBox"/>

                                        <TextBlock Text="Контакты" FontWeight="Medium" Margin="10"/>
                                        <TextBlock Text="Контактов нет" TextAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Items.Count, ElementName=ContactsItemsControl}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="250">
                                            <ItemsControl Name="CreateGroupContactsItemsControl">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <ItemContainerTemplate>
                                                        <Grid Height="60" MouseLeftButtonUp="ContactSelect_Item_Click">
                                                            <Grid.Style>
                                                                <Style TargetType="Grid">
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupMouseOverBackground}"/>
                                                                        </Trigger>
                                                                        <DataTrigger Binding="{Binding IsSelectedContact}" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupSelectedBackground}"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Grid.Style>
                                                            <Grid Margin="10">

                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="50"/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>

                                                                <ToggleButton Grid.Column="0" Width="40" Height="40" IsChecked="{Binding IsSelectedContact}" Style="{StaticResource MaterialDesignActionToggleButton1}">
                                                                    <ToggleButton.Content>
                                                                        <Image Source="{Binding UserImage}"></Image>
                                                                    </ToggleButton.Content>
                                                                    <materialDesign:ToggleButtonAssist.OnContent>
                                                                        <Grid>
                                                                            <Image Source="{Binding UserImage}"/>
                                                                            <Grid Background="Black" Opacity="0.7"/>
                                                                            <materialDesign:PackIcon Kind="Check" Foreground="White" FontWeight="Medium" 
                                                                                                     VerticalAlignment="Center" HorizontalAlignment="Center"></materialDesign:PackIcon>

                                                                        </Grid>
                                                                    </materialDesign:ToggleButtonAssist.OnContent>
                                                                </ToggleButton>

                                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding Contact.DisplayName}" Margin="0 3"/>
                                                                    <TextBlock Margin="0 3">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="{Binding Contact.LastTimeOnline, Converter={StaticResource DateTimeToLastTimeOnline}}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Contact.IsOnline}" Value="True">
                                                                                        <Setter Property="Text" Value="Online"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Grid>
                                                    </ItemContainerTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                                            <Button Content="Отменить" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Click="CreateGroupClose_Button_Click" Margin="5 0"/>
                                            <Button Content="Создать" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Click="CreateGroup_Button_Click" Margin="5 0"/>
                                        </StackPanel>

                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="ContactsDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsContactsDialogOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsContactsDialogOpen}" MouseLeftButtonUp="SettingsClose_Background_Click"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsContactsDialogOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Контакты" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="0">
                                    <StackPanel MaxHeight="400">
                                        <TextBlock Text="Контактов нет" TextAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Items.Count, ElementName=ContactsItemsControl}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <ScrollViewer MaxHeight="250" VerticalScrollBarVisibility="Auto" Margin="0 0 0 10">
                                            <ItemsControl Name="ContactsItemsControl">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <ItemContainerTemplate>
                                                        <Grid Height="60" MouseLeftButtonUp="ChatOpen_MenuItem_Click">
                                                            <Grid.Style>
                                                                <Style TargetType="Grid">
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupMouseOverBackground}"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Grid.Style>
                                                            <Grid.ContextMenu>
                                                                <ContextMenu>
                                                                    <MenuItem Header="Открыть диалог" Click="ChatOpen_MenuItem_Click"/>
                                                                    <MenuItem Header="Удалить" Click="ContactDelete_MenuItem_Click"/>
                                                                </ContextMenu>
                                                            </Grid.ContextMenu>
                                                            <Grid Margin="10">

                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="50"/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>

                                                                <Ellipse Grid.Column="0" Width="40" Height="40">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding UserImage}"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>

                                                                <StackPanel Grid.Column="1">
                                                                    <TextBlock Text="{Binding Contact.DisplayName}" Margin="4 3"/>
                                                                    <TextBlock Margin="4 3">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="{Binding Contact.LastTimeOnline, Converter={StaticResource DateTimeToLastTimeOnline}}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Contact.IsOnline}" Value="True">
                                                                                        <Setter Property="Text" Value="Online"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Grid>
                                                    </ItemContainerTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <TextBox Height="40" Margin="10 0" materialDesign:HintAssist.Hint="Логин"
                                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}" FontSize="16" Name="ContactLoginTextBox"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                                            <Button Content="Отменить" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Click="ContactsClose_Button_Click" Margin="5 0"/>
                                            <Button Content="Добавить" Style="{StaticResource MaterialDesignFlatButton}" Template="{DynamicResource FlatSubMenuButtonControlTemplate}" 
                                                Click="ContactAdd_Button_Click" Margin="5 0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="SettingsDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSettingsOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>

                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsSettingsOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSettingsOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="350" ClipToBounds="True">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="60"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5 0">
                                    <Button Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" Foreground="{StaticResource DialogIconsForeground}" Height="40" Width="40" Padding="0"
                                            Content="{materialDesign:PackIcon ArrowBack, Size=25}" Name="SettingsBackButton" Click="SettingsBack_Button_Click">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                <Setter Property="Visibility" Value="Visible"></Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SettingsHeader}" Value="Настройки">
                                                        <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <TextBlock Name="HeaderTextBlock" Text="{Binding SettingsHeader}" FontSize="16" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Margin" Value="20 18"></Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Visibility, ElementName=SettingsBackButton}" Value="Visible">
                                                        <Setter Property="Margin" Value="5 18"></Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                <Button Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatCircleButtonWithOutProgresBarControlTemplate}" 
                                    Content="{materialDesign:PackIcon Kind=Close, Size=25}" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Top" 
                                    Padding="0" Width="40" Height="40" Margin="10" Click="SettingsClose_Button_Click" Foreground="{StaticResource DialogIconsForeground}"/>

                                <Grid Grid.Row="1" Height="400">
                                    <Grid Name="InnerSettingsMainGrig">
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                <Setter Property="RenderTransform">
                                                    <Setter.Value>
                                                        <TranslateTransform X="0" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsMainSettingsOpen}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard Storyboard="{StaticResource OpenMainSubMenuStoryboard}"/>
                                                        </DataTrigger.EnterActions>
                                                        <DataTrigger.ExitActions>
                                                            <BeginStoryboard Storyboard="{StaticResource CloseMainSubMenuStoryboard}"/>
                                                        </DataTrigger.ExitActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="100"/>
                                            <RowDefinition Height="10"/>
                                            <RowDefinition/>
                                            <RowDefinition Height="10"/>
                                            <RowDefinition Height="60"/>

                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="1" Background="{StaticResource DialogBackground}"></Grid>
                                        <Grid Grid.Row="3" Background="{StaticResource DialogBackground}"></Grid>

                                        <Grid Grid.Row="0" Margin="0 0 0 10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="100"/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>


                                                <Ellipse Name="SettingsUserImage" Grid.Column="0" Width="70" Height="70" HorizontalAlignment="Right">
                                                    <Ellipse.Fill>
                                                        <ImageBrush ImageSource="{Binding LoginedUserImage}"/>
                                                    </Ellipse.Fill>
                                                </Ellipse>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="25">
                                                    <TextBlock TextWrapping="NoWrap" FontWeight="Medium" FontSize="18"  Text="{Binding LoginedUser.DisplayName}" Foreground="{StaticResource DialogForeground}"/>
                                                    <TextBlock Text="{Binding LoginedUser.Email}" Margin="0 5" Foreground="{StaticResource DialogSecondForeground}"/>
                                                </StackPanel>


                                            </Grid>
                                        </Grid>

                                        <Border Grid.Row="2" Padding="0 7">
                                            <StackPanel >

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" Height="50" Click="ProfileSettingsOpen_Button_Click">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=InfoOutline, Size=25}" Margin="0 0 15 0"/>
                                                        <TextBlock Text="Изменить профиль" FontSize="16" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}"  
                                                        Height="50" Click="PrivacySettingsOpen_Button_Click">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=LockOutline, Size=25}" Margin="0 0 15 0"/>
                                                        <TextBlock Text="Конфиденциальность" FontSize="16" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}"  Height="50">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=Database, Size=25}" Margin="0 0 15 0"/>
                                                        <TextBlock Text="Хранение" FontSize="16" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}"  Height="50">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=MixerSettings, Size=25}" Margin="0 0 15 0"/>
                                                        <TextBlock Text="Дополнительно" FontSize="16" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>

                                            </StackPanel>
                                        </Border>
                                        <Border Grid.Row="4" Padding="0 7">
                                            <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" Height="50">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                    <ContentControl Content="{materialDesign:PackIcon Kind=QuestionMarkCircleOutline, Size=25}" Margin="0 0 15 0"/>
                                                    <TextBlock Text="Справка" FontSize="16" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </Border>
                                    </Grid>

                                    <Grid Name="InnerSettingsEditProfileGrid">
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                <Setter Property="RenderTransform">
                                                    <Setter.Value>
                                                        <TranslateTransform X="0" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsProfileSettingsOpen}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard Storyboard="{StaticResource OpenSubMenuStoryboard}"/>
                                                        </DataTrigger.EnterActions>
                                                        <DataTrigger.ExitActions>
                                                            <BeginStoryboard Storyboard="{StaticResource CloseSubMenuStoryboard}"/>
                                                        </DataTrigger.ExitActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>

                                        <StackPanel>
                                            <Grid Height="160" Background="{StaticResource DialogBackground}">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition/>
                                                    <RowDefinition Height="60"/>
                                                </Grid.RowDefinitions>
                                                <Ellipse Grid.Column="0" Width="75" Height="75" HorizontalAlignment="Center" Margin="10" VerticalAlignment="Bottom"
                                                         Name="ProfileSettingsUserImage">
                                                    <Ellipse.Fill>
                                                        <ImageBrush ImageSource="{Binding LoginedUserImage}"/>
                                                    </Ellipse.Fill>
                                                </Ellipse>

                                                <Button Margin="10" VerticalAlignment="Top" Background="DodgerBlue" Width="250" Grid.Row="1" 
                                                        Template="{StaticResource FlatButtonControlTemplate}" Style="{StaticResource MaterialDesignRaisedAccentButton}" 
                                                        Content="установить фото профиля" Click="ChangeUserImage_Button_Click"/>
                                            </Grid>

                                            <StackPanel Margin="0 7">
                                                <StackPanel Orientation="Horizontal"  Width="300" Height="50">
                                                    <ContentControl Content="{materialDesign:PackIcon Kind=UserOutline, Size=25}" VerticalAlignment="Center" Margin="0 0 15 0" Foreground="{StaticResource DialogIconsForeground}"/>
                                                    <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" materialDesign:HintAssist.Hint="Имя" Name="ProfileDisplayNameTextBlock"
                                                             Text="{Binding LoginedUser.DisplayName, Mode=OneWay}" FontSize="16" VerticalAlignment="Center" Width="250" Foreground="White"/>
                                                </StackPanel>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" Height="50" Click="EmailSettingsOpen_Button_Click">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=Email, Size=25}" Margin="0 0 15 0" Foreground="{StaticResource DialogIconsForeground}"/>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding LoginedUser.Email}" Foreground="White" FontSize="14" FontWeight="Light" VerticalAlignment="Center"/>
                                                            <TextBlock Text="Почта" FontSize="13" VerticalAlignment="Center" Foreground="{StaticResource DialogIconsForeground}"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Button>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" Height="50"
                                                        Click="LoginSettingsOpen_Button_Click">
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="300">
                                                        <ContentControl Content="{materialDesign:PackIcon Kind=AlternateEmail, Size=25}" Margin="0 0 15 0" Foreground="{StaticResource DialogIconsForeground}"/>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding LoginedUser.Login, StringFormat=@{0}}" Foreground="White" FontWeight="Light" FontSize="14" VerticalAlignment="Center"/>
                                                            <TextBlock Text="Логин" FontSize="13" VerticalAlignment="Center" Foreground="{StaticResource DialogIconsForeground}"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Button>

                                                    <TextBox Style="{StaticResource MaterialDesignTextBox}" materialDesign:HintAssist.Hint="О себе" 
                                                             FontSize="16" VerticalAlignment="Center" Width="300" Height="30" Margin="0 3 0 4" Foreground="White"/>
                                                
                                                <TextBlock Width="300" TextWrapping="Wrap" Margin="0 0 0 5"
                                                           Text="Любые подробности, например возраст, род занятий или город"></TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Name="InnerSettingsPrivacyGrid">
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                <Setter Property="RenderTransform">
                                                    <Setter.Value>
                                                        <TranslateTransform X="0" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsSettingsPrivacyOpen}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard Storyboard="{StaticResource OpenSubMenuStoryboard}"/>
                                                        </DataTrigger.EnterActions>
                                                        <DataTrigger.ExitActions>
                                                            <BeginStoryboard Storyboard="{StaticResource CloseSubMenuStoryboard}"/>
                                                        </DataTrigger.ExitActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>

                                        <StackPanel>

                                            <StackPanel Margin="0 7">

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" 
                                                        Height="50" Click="PasswordChangeDialogOpen_Button_Click" Content="Изменить пароль">
                                                </Button>

                                                <Button Template="{StaticResource FlatMenuButtonControlTemplate}" Style="{StaticResource MaterialDesignFlatButton}" 
                                                        Height="50" Click="BlockedUsersDialogOpen_Button_Click" Content="Заблокированные пользователи">
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>

                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="SettingsNewEmailDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsEmailSettingsOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsEmailSettingsOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEmailSettingsOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Почта" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="10 0">
                                    <StackPanel>
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="5" materialDesign:HintAssist.Hint="Текущая почта" Text="{Binding LoginedUser.Email}" IsReadOnly="True"/>
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="5" materialDesign:HintAssist.Hint="Новая почта" Name="NewEmailTextBox" TextChanged="EmailSettingaNewEmailTextBox_OnTextChanged"/>
                                        <PasswordBox Style="{StaticResource MaterialDesignFloatingHintPasswordBox}" Margin="5" materialDesign:HintAssist.Hint="Пароль от аккаунта" 
                                                     Name="NewEmailPasswordPasswordBox" PasswordChanged="EmailSettingsPasswordBox_OnPasswordChanged"/>
                                        <Button Template="{StaticResource FlatButtonControlTemplate}" Content="Отправить код подтверждения" Margin="5" Click="EmailSettingsSendCodeToNewMail_Button_Click" Name="SendEmailCodeButton">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                    <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                    <Style.Triggers>
                                                        <DataTrigger Value="True" Binding="{local:MultiBinder {Binding IsEmailVerifiedForEmailSettings}, {Binding IsPasswordVerifiedForEmailSettings}, {StaticResource VerifyConvertrer}}">
                                                            <Setter Property="Visibility" Value="Visible"></Setter>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="5" materialDesign:HintAssist.Hint="Код" Name="SettingsEmailCodeTextBox" Visibility="Collapsed"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 5">
                                            <Button Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Отмена" Margin="5" Click="EmailSettingsClose_Button_Click"></Button>
                                            <Button Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Сохранить" Margin="5" Click="EmailSettingsSaveNewEmail_Button_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Text, ElementName=SettingsEmailCodeTextBox}" Value="">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="SettingsLoginDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSettingsLoginOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsSettingsLoginOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSettingsLoginOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Логин" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="10 0">
                                    <StackPanel>
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="5" FontSize="15" FontWeight="Light" TextChanged="LoginSettingsLogin_TextBox_TextChanged"
                                                 materialDesign:HintAssist.Hint="@username" Text="{Binding LoginedUser.Login, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Name="LoginSettingsLoginTextBox"/>

                                        <TextBlock Margin="5 0" FontWeight="Light" LineHeight="20" FontSize="15" TextWrapping="NoWrap">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Это имя пользователя доступно"/>
                                                    <Setter Property="Foreground" Value="{StaticResource DialogLoginEnabledForeground}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsLoginVerifiedForLoginSettings}" Value="False">
                                                            <Setter Property="Text" Value="Это имя пользователя недоступно"/>
                                                            <Setter Property="Foreground" Value="{StaticResource DialogLoginDisabledForeground}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>


                                        <TextBlock Margin="5 10" FontWeight="Light" LineHeight="20" FontSize="15" TextWrapping="Wrap" Text="Вы можете выбрать публичное имя пользователя. Другие пользователи смогут найти Вас и связаться.">
                                        </TextBlock>
                                        <TextBlock Margin="5 -5" FontWeight="Light" LineHeight="20" FontSize="15" TextWrapping="Wrap" Text="Можно использовать латиницу (a-z), цифры (0-9). Минимальная длина — 6 символов, максимальная 24. ">
                                        </TextBlock>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 5">
                                            <Button Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Content="Отмена" Margin="5" Click="LoginSettingsClose_Button_Click"></Button>

                                            <Button Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Сохранить" Margin="5" Click="LoginSettingsSaveNewLogin_Button_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsLoginVerifiedForLoginSettings}" Value="False">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="SettingsChangePasswordDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSettingsPasswordOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsSettingsPasswordOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSettingsPasswordOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Изменить пароль" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="10 0">
                                    <StackPanel>
                                        <PasswordBox Style="{StaticResource MaterialDesignFloatingHintPasswordBox}" Margin="5" PasswordChanged="ChangePasswordCurrentPasswordBox_OnPasswordChanged"
                                                 materialDesign:HintAssist.Hint="Введите текущий пароль" Name="SettingsPasswordCurrentPasswordBox"/>

                                        <PasswordBox Style="{StaticResource MaterialDesignFloatingHintPasswordBox}" Margin="5" PasswordChanged="ChangePasswordCurrentPasswordBox_OnPasswordChanged"
                                                 materialDesign:HintAssist.Hint="Введите новый пароль" Name="SettingsPasswordNewPasswordBox"/>

                                        <PasswordBox Style="{StaticResource MaterialDesignFloatingHintPasswordBox}" Margin="5" PasswordChanged="ChangePasswordCurrentPasswordBox_OnPasswordChanged"
                                                 materialDesign:HintAssist.Hint="Подтвердите пароль" Name="SettingsPasswordConfirmNewPasswordBox"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 5">

                                            <Button Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Content="Отмена" Margin="5" Click="ChangePasswordDialogClose_Button_Click"></Button>

                                            <Button Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Сохранить" Margin="5" Click="ChangePasswordSaveNewPassword_Button_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsPasswordsVerifiedForPasswordSettings}" Value="False">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>

                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="RestorePasswordDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsRestorePasswordOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsRestorePasswordOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsRestorePasswordOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="300">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Забыл пароль" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="10 0">
                                    <StackPanel>
                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="10 0" 
                                                 materialDesign:HintAssist.Hint="Введите логин или почту" Name="RestorePasswordLoginTextBox"/>

                                        <Button Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Отправить код подтверждения" Margin="5" Click="RestorePasswordSendEmailCode_Button_Click">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                    <Setter Property="Visibility" Value="Visible"></Setter>
                                                    <Style.Triggers>
                                                        <DataTrigger Value="" Binding="{Binding Text, ElementName=RestorePasswordLoginTextBox}">
                                                            <Setter Property="Visibility" Value="Collapsed"></Setter>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>

                                        <PasswordBox Margin="10 5" PasswordChanged="RestorePasswordNewPasswordBox_OnPasswordChanged"
                                                     materialDesign:HintAssist.Hint="Введите новый пароль" Name="RestorePasswordNewPasswordBox">
                                            <PasswordBox.Style>
                                                <Style TargetType="PasswordBox" BasedOn="{StaticResource MaterialDesignFloatingHintPasswordBox}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Visibility, ElementName=RestorePasswordEmailCodeTextBox}" Value="Visible">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </PasswordBox.Style>
                                        </PasswordBox>

                                        <PasswordBox Margin="10 0" PasswordChanged="RestorePasswordNewPasswordBox_OnPasswordChanged"
                                                     materialDesign:HintAssist.Hint="Подтвердите пароль" Name="RestorePasswordConfirmNewPasswordBox">
                                            <PasswordBox.Style>
                                                <Style TargetType="PasswordBox" BasedOn="{StaticResource MaterialDesignFloatingHintPasswordBox}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Visibility, ElementName=RestorePasswordEmailCodeTextBox}" Value="Visible">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </PasswordBox.Style>
                                        </PasswordBox>

                                        <TextBox Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="10" 
                                                 materialDesign:HintAssist.Hint="Код" Name="RestorePasswordEmailCodeTextBox" Visibility="Collapsed"/>

                                        <TextBlock TextWrapping="Wrap" Margin="10" Text="Восстановить пароль можно только если была привязана почта"></TextBlock>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 5">

                                            <Button Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                    Content="Отмена" Margin="5" Click="RestorePasswordDialogClose_Button_Click"/>

                                            <Button Template="{StaticResource FlatSubMenuButtonControlTemplate}" Content="Сохранить" Margin="5" Click="RestorePasswordSave_Button_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsPasswordsVerifiedForRestorePasword}" Value="False">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>

                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="BlackListDialog">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsBlackListOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid MouseLeftButtonUp="SettingsClose_Background_Click" Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsBlackListOpen}"/>
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsBlackListOpen}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                    <Grid>
                        <Grid>
                            <Grid Width="335">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="50"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Черный список" FontSize="16" Margin="20 18" VerticalAlignment="Center" FontWeight="Medium" Foreground="{StaticResource DialogHeaderForeground}"/>

                                <Grid Grid.Row="1" Margin="0">
                                    <StackPanel MaxHeight="400">
                                        <TextBlock Text="Список пуст" TextAlignment="Center" Margin="10">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Items.Count, ElementName=BlackListItemsControl}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <ScrollViewer MaxHeight="250" VerticalScrollBarVisibility="Auto" Margin="0 0 0 10">
                                            <ItemsControl Name="BlackListItemsControl">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <ItemContainerTemplate>
                                                        <Grid Height="60" MouseLeftButtonUp="ChatOpen_MenuItem_Click">
                                                            <Grid.Style>
                                                                <Style TargetType="Grid">
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource GroupMouseOverBackground}"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Grid.Style>
                                                            <Grid Margin="10">

                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="50"/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>

                                                                <Ellipse Grid.Column="0" Width="40" Height="40">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding BlockedUserImage}"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>

                                                                <Grid Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Right"
                                                                      Margin="5" Background="Transparent">
                                                                    <TextBlock Margin="5" Text="Удалить" Style="{StaticResource RegisterTextBlockStyle}"
                                                                               MouseLeftButtonUp="BlackListRemoveUser_TextBlock_MouseLeftButtonUp"/>
                                                                </Grid>

                                                                <StackPanel Grid.Column="1">
                                                                    <TextBlock Text="{Binding User.DisplayName}" HorizontalAlignment="Left" Margin="4 3"/>
                                                                    <TextBlock Margin="4 3" HorizontalAlignment="Left">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="{Binding User.LastTimeOnline, Converter={StaticResource DateTimeToLastTimeOnline}}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding User.IsOnline}" Value="True">
                                                                                        <Setter Property="Text" Value="Online"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Grid>
                                                    </ItemContainerTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <Button HorizontalAlignment="Right" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" 
                                                Content="Отмена" Margin="0 0 10 10" Click="Blacklist_Cansel_Button_Click"></Button>

                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Name="CommunicatiobErrorGrid">
                <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsActive, ElementName=CommunicationErrorDialog}"/>
                <materialDesign:Snackbar MessageQueue="{materialDesign:MessageQueue}" materialDesign:ShadowAssist.ShadowDepth="Depth3"
                x:Name="CommunicationErrorDialog" Background="{StaticResource MessagesBackground}" Padding="5" VerticalAlignment="Bottom">
                    <materialDesign:Snackbar.Message>
                        <materialDesign:SnackbarMessage>
                            <StackPanel Orientation="Horizontal">
                                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                         Value="-1" IsIndeterminate="True" Margin="5 0"/>
                                <TextBlock VerticalAlignment="Center" Margin="5 0" Foreground="{StaticResource GroupTextForeground}" Text="Нет соединения"></TextBlock>
                                <Button Content="Подключиться" Style="{StaticResource MaterialDesignFlatButton}" Template="{StaticResource FlatSubMenuButtonControlTemplate}" Click="Reconnect_Button_Click"></Button>
                            </StackPanel>
                        </materialDesign:SnackbarMessage>
                    </materialDesign:Snackbar.Message>
                </materialDesign:Snackbar>
            </Grid>

        </Grid>


        <Grid Name="MessageDialog" Grid.Row="1">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsMessageBoxOpen}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsMessageBoxOpen}"/>
            <Grid>
                <Grid.Style>
                    <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsMessageBoxOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>

                <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                <StackPanel Margin="20">
                    <TextBlock TextAlignment="Center" Text="" Margin="5" Name="MessageDialogTextBlock"/>
                    <Button Content="Ok" Margin="0 5" Style="{StaticResource MaterialDesignFlatButton}"
                           Click="MessageBoxOk_Button_Click" Template="{StaticResource FlatSubMenuButtonControlTemplate}"/>
                </StackPanel>
            </Grid>
        </Grid>

        <Grid Name="LoadingDialog" Grid.Row="1">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsLoadingOpen}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Storyboard="{StaticResource OpenMainGridStoryboard}"/>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard Storyboard="{StaticResource CloseMainGridStoryboard}"/>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <Grid Style="{StaticResource DialogBackgroundGrid}" DataContext="{Binding IsLoadingOpen}"/>
            <Grid>
                <Grid.Style>
                    <Style TargetType="Grid" BasedOn="{StaticResource DialogGrid}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsLoadingOpen}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource OpenStoryboard}"/>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource ExitStoryboard}"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Rectangle Fill="{StaticResource DialogItemBackground}" RadiusY="6" RadiusX="6"/>
                <ProgressBar Margin="10" Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="-1" IsIndeterminate="True" />
            </Grid>
        </Grid>

    </Grid>

</Window>